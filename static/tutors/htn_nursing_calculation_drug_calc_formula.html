<div style="display: flex; justify-content: center; align-items: center;">
    <form class="" style="width: 650px;">

        <div class="container" style="margin: 3%;">
            <div class="row">
                <div class="col-sm">
                    <div style="text-align: center;">
                        <h3>Calculate the appropriate dosage</h3>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm">
                </div>
                <div class="col-sm">
                    <input disabled type="text" id="initial_problem" class="form-control"
                        style="width: 500px; display: none;">
                    <div style="text-align: center; width: 500px;" id="initial_problem_text"></div>
                </div>
                <div class="col-sm">
                </div>
            </div>
        </div>

        <div class="container level_2" style="margin: 2%; display:none; margin-bottom: 25px">
            <div class="row">
                    <p><strong>Fill in the information given from the problem.</strong></p>
            </div>
            <div class="row">
                <div class="col-sm">
                    <p>Identify the Supply:</p>
                </div>
                <div class="col-sm">
                    <p>Identify the Order:</p>
                </div>
            </div>
            <div class="row">
                <div class="col-sm">
                    <div class="row" style="flex-wrap: nowrap;align-items: center;">
                        <div class="col">
                            <math-field id="supply_numerator" data-column="1" data-row="1" class="form-control" value="" style="width: 75px; margin-bottom: 5px;"></math-field>
                        </div>
                        <div class="col">
                            <select id="supply_numerator_units" style="height: 40px;width: 150px;">
                                <option value="" selected disabled hidden>unit</option>
                                <option value="tablet">tablet</option>
                                <option value="mg">mg</option>
                                <option value="mcg">mcg</option>
                            </select>
                        </div>
                    </div>
                    <div class="row" style="flex-wrap: nowrap;align-items: center;">
                        <div class="col">
                            <math-field id="supply_denominator" data-column="1" data-row="1" class="form-control" value="" style="width: 75px; margin-bottom: 5px;"></math-field>
                        </div>
                        <div class="col">
                            <select id="supply_denominator_units" style="height: 40px;width: 150px;">
                                <option value="" selected disabled hidden>unit</option>
                                <option value="tablet">tablet</option>
                                <option value="mg">mg</option>
                                <option value="mcg">mcg</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="col-sm"></div>
                
                <div class="col-sm">
                    <div class="row" style="flex-wrap: nowrap;align-items: center;">
                        <div class="col">
                            <math-field id="order_numerator" data-column="1" data-row="1" class="form-control" value="" style="width: 75px; margin-bottom: 5px;"></math-field>
                        </div>
                        <div class="col">
                            <select id="order_numerator_units" style="height: 40px;width: 150px;">
                                <option value="" selected disabled hidden>unit</option>
                                <option value="tablet">tablet</option>
                                <option value="mg">mg</option>
                                <option value="mcg">mcg</option>
                            </select>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>

        <div class="container level_1" style="margin: 2%; display:none;">
            <p><strong>Apply the formula</strong></p>
            <div class="row">
                <div class="col-sm">
                    <div class="row" style="flex-wrap: nowrap;align-items: center;">
                        <div class="col">
                            <math-field id="formula_desired" data-column="1" data-row="1" class="form-control" value="" style="width: 75px; margin-bottom: 5px;"></math-field>
                        </div>
                        x
                        <div class="col">
                            <math-field id="formula_quantity" data-column="1" data-row="1" class="form-control" value="" style="width: 75px; margin-bottom: 5px;"></math-field>
                        </div>
                    </div>
                    <div class="row" style="flex-wrap: nowrap;align-items: center;">
                        <div class="col">
                            <math-field id="formula_have" data-column="1" data-row="1" class="form-control" value="" style="width: 75px; margin-bottom: 5px;"></math-field>
                        </div>

                    </div>
                </div>
                <div class="col-sm">
                    <button id="level_2" class="btn btn-danger scaffold">+</button>
                </div>
            </div>
        </div>

        <div class="container level_0" style="margin: 2%;">
            <div class="row">
                <div class="col-sm">
                    <label for="final_answer" style="padding-bottom:15px">What is the appropriate dosage?</label>
                    <math-field id="final_answer" virtual-keyboard-mode="onfocus"
                        style="width: 569px; border: 1px solid rgba(0, 0, 0, .3);"></math-field>
                </div>
                <div class="col-sm">
                    <button id="level_1" style="margin-left:-10px;margin-top:43px"
                        class="btn btn-danger scaffold">+</button>
                </div>
            </div>
        </div>
    </form>
</div>


<script>
    function populateDropDowns(u1, u2, u3) {
        let options = [];
        if (u1 === u2) {
            options = [u1, u3];
        } else {
            options = [u1, u2, u3];
        }

        function populateDropdown(id) {
            const select = document.getElementById(id);
            select.innerHTML = ''; // clear existing options

            // Blank default option - must select
            const blankOption = document.createElement('option');
            blankOption.value = '';
            blankOption.disabled = true;
            blankOption.selected = true;
            blankOption.hidden = true;
            select.appendChild(blankOption);

            // Populate with allowed units
            options.forEach(option => {
                if (option) {
                    const opt = document.createElement('option');
                    opt.value = option;
                    opt.textContent = option;
                    select.appendChild(opt);
                }
            });
        }

        populateDropdown('supply_numerator_units');
        populateDropdown('supply_denominator_units');
        populateDropdown('order_numerator_units');
    }


    $(document).ready(function () {
        const initial_problem = $('#initial_problem').val();
        const prob = initial_problem.split(',');
        // [words, n1, u1, n2, u2, u3, n3]
        const u1 = prob[2];
        const u2 = prob[4];
        const u3 = prob[5];

        populateDropDowns(u1, u2, u3);
    });
</script>
